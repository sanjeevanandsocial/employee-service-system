<div class="page-header">
  <h1 class="page-title">Projects</h1>
  <div style="display: flex; gap: 10px;">
    <button type="button" onclick="toggleFilter()" class="toggle-filter-btn" id="toggleBtn">
      <i class="fas fa-filter"></i> Show Filters
    </button>
    <% if current_user.has_permission?('project_create') %>
    <%= link_to new_project_path, class: "add-btn" do %>
      <i class="fas fa-plus"></i> Add Project
    <% end %>
    <% end %>
  </div>
</div>

<div class="filter-section" id="filterSection" style="display: none;">
  <%= form_with url: projects_path, method: :get, class: "filter-form" do |f| %>
    <%= f.number_field :id, value: params[:id], placeholder: "Search by ID", class: "filter-input" %>
    <%= f.text_field :title, value: params[:title], placeholder: "Search by title", class: "filter-input" %>
    <%= f.select :status, Project.statuses.keys.map { |s| [s.titleize.gsub('_', ' '), s] }, { include_blank: "All Status" }, { selected: params[:status], class: "filter-input" } %>
    <%= f.button type: :submit, class: "filter-btn" do %>
      <i class="fas fa-search"></i> Search
    <% end %>
    <%= link_to projects_path, class: "clear-btn" do %>
      <i class="fas fa-times"></i> Clear
    <% end %>
  <% end %>
</div>

<script>
  function toggleFilter() {
    const filterSection = document.getElementById('filterSection');
    const toggleBtn = document.getElementById('toggleBtn');
    if (filterSection.style.display === 'none') {
      filterSection.style.display = 'block';
      toggleBtn.innerHTML = '<i class="fas fa-filter"></i> Hide Filters';
    } else {
      filterSection.style.display = 'none';
      toggleBtn.innerHTML = '<i class="fas fa-filter"></i> Show Filters';
    }
  }
</script>

<div class="total-records">
  Total Records: <%= @projects.total_count %>
</div>

<% if @projects.any? %>
  <table class="employees-table">
    <thead>
      <tr>
        <th>#Project ID</th>
        <th style="width: 30%;">Project Title</th>
        <th style="text-align:center;">Status</th>
        <th style="text-align:right;">Start Date</th>
        <th style="text-align:right;">End Date</th>
        <th style="text-align:right;">Actions</th>
      </tr>
    </thead>

    <tbody>
      <% @projects.each do |project| %>
        <tr>
          <td><%= project.id %></td>
          <td><span class="project-title"><%= project.title %></span></td>

          <td style="text-align:center;">
            <% status_class =
                case project.status
                  when "planned" then "status-paused"
                  when "in_progress" then "status-active"
                  when "on_hold" then "status-paused"
                  when "completed" then "status-completed"
                  when "cancelled" then "status-frozen"
                end
            %>

            <span class="status-badge <%= status_class %>">
              <%= project.status.gsub('_', ' ').titleize %>
            </span>
          </td>

          <td style="text-align:right; font-size: 12px;"><%= format_display_date(project.start_date) %></td>
          <td style="text-align:right; font-size: 12px;"><%= format_display_date(project.end_date) %></td>

          <td style="text-align:right;">
          <% if current_user.has_permission?('project_modify_employees') %>
          <%= link_to details_project_path(project), class: "action-btn btn-details" do %>
            <i class="fas fa-info-circle"></i> Details
          <% end %>
          <% end %>
          <% if current_user.has_permission?('project_modify') %>
            <%= link_to edit_project_path(project), class: "action-btn btn-edit" do %>
              <i class="fas fa-edit"></i> Modify
            <% end %>
          <% end %>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>
  
  <div class="table-footer">
    <%= link_to projects_path(format: :csv, id: params[:id], title: params[:title], status: params[:status]), class: "export-csv-btn" do %>
      <i class="fas fa-download"></i> Export as CSV
    <% end %>
    <div class="pagination-container">
      <%= paginate @projects %>
    </div>
  </div>
<% else %>
  <div class="empty-state">
    <div class="empty-icon">
      <i class="fas fa-project-diagram"></i>
    </div>
    <h2 class="empty-title">No Projects Found</h2>
    <p class="empty-message">You haven't created any projects yet. Get started by creating your first project.</p>
    <% if current_user.has_permission?('project_create') %>
    <%= link_to new_project_path, class: "add-btn" do %>
      <i class="fas fa-plus"></i> Create New Project
    <% end %>
    <% end %>
  </div>
<% end %>
